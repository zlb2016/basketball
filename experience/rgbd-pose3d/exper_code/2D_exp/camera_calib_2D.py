#!/usr/bin/env python
# -*- coding:utf-8 -*-
from utils.Camera import *
import scipy.misc
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
CONF_THRESH = 0.25
def calibration(color_img,coords_pred):
    # load data
    color = scipy.misc.imread(color_img)  # color image
    color = scipy.misc.imresize(color, (1080, 1920))
    # intrinsic calibration data
    ratio = np.array([1920.0/512.0, 1080.0/424.0])
    # K = np.array([[3.7132019636619111e+02 * ratio[0], 0.0, 2.5185416982679811e+02 * ratio[0]],
    #                [0.0, 3.7095047063504268e+02 * ratio[1], 2.1463524817996452e+02 * ratio[1]],
    #                [0.0, 0.0, 1.0]])
    K = np.array([[3.42938209e-01 * ratio[0], 8.72629655e-04* ratio[0], -7.28786114e+01 * ratio[0]],
                   [3.43287830e-04* ratio[1], 3.43578203e-01 * ratio[1],  1.75767495e+01 * ratio[1]],
                   [0.0, 0.0, 1.0]])
    # K=np.array([[2.90778446e+00* ratio[0], -1.04633946e-02* ratio[0],  2.15505801e+02* ratio[0]],
    #                [-3.43830682e-03* ratio[1],  2.91094100e+00* ratio[1], -5.13416831e+01* ratio[1]],
    #                [0.00000000e+00,  0.00000000e+00,  1.00000000e+00]])
    cam = Camera(K)
    #画图
    fig = plt.figure()
    ax = fig.add_subplot(111)
    # ax.imshow(color)
    det_conf=np.array([[0.62123996, 0.54721093, 0.50915444, 0.02518296, 0.0175833 ,
        0.5077482 , 0.2954227 , 0.25194424, 0.569689  , 0.65371644,
        0.7939661 , 0.6282181 , 0.62515855, 0.7038113 ]])
    #根据3D骨架坐标得到彩色图上的2D坐标
    for i in range(coords_pred.shape[0]):
        print("coords_pred[i, :, :]", coords_pred[i, :, :])
        coord2d = cam.project(coords_pred[i, :, :])
        vis = det_conf[i, :] > CONF_THRESH
        ax.plot(coord2d[vis, 0], coord2d[vis, 1], 'ro')
    plt.show()

if __name__ == "__main__":
    color_img='../../pictures/rgb/P008/frames_00001.png'#载入数据集图片
    coords_pred=np.array([
    [[0.06700699545454541, 0.6702894868181818, -0.18759062121212056], 
    [0.03541239545454544, 0.41677468681818186, -0.16763462121212092], 
    [0.20227489545454547, 0.3481538868181818, -0.22090462121212084], 
    [0.22664809545454545, 0.3552073868181818, -0.4534826212121206], 
    [0.11221469545454543, 0.5174000868181818, -0.47787262121212093], 
    [-0.09248410454545458, 0.4266818868181818, -0.19638362121212083], 
    [-0.16615340454545455, 0.4720252868181818, -0.4177576212121208], 
    [0.011102395454545444, 0.5357513868181818, -0.48689262121212096], 
    [0.05778429545454544, -0.07045191318181818, -0.05581162121212069], 
    [0.07088999545454544, -0.3336989131818182, -0.07126362121212093], 
    [0.07685099545454543, -0.5963649131818182, 0.08160037878787918], 
    [-0.09872450454545456, -0.04128941318181817, -0.03824862121212069], 
    [-0.11036780454545456, -0.31674901318181825, 0.021085378787879083], 
    [-0.03946690454545454, -0.5902369131818183, 0.19702437878787915]]
    ])#真实三维骨架坐标
    calibration(color_img,coords_pred)
    pass